### 分布式监控系统
- 监控系统的四个核心指标：
1. 延迟
2. 流量
3. 错误
4. 饱和度
- 长尾问题：监控中使用平均值量化指标在面对波动大的指标时候不能体现出其特点，因此可以进行分组计数，如延迟为0~10ms的请求有多少个，30~100ms的请求有多少个
- 系统的不同部分应该以不同的精度进行度量，避免频繁监控导致系统开销过高
- 尽量精简化监控系统的数据：保证监控系统可以支持快速的定位与检测

### Google 自动化系统的演进

- 自动化的价值
1. 一致性：一致性地执行范围明确、步骤已知的程序。也就是替代人的不可靠性
2. 平台性：自动化系统提供了一个课扩展的、广泛适用的、甚至带来额外收益的平台。同时，此平台也将错误的集中化了。
3. 修复速度更快：
4. 行动速度够快：快速的进行故障转移与流量调整
5. 节省时间

- Google的思想是尽可能使用机器管理机器，但是实际情况要变通，不是每一个系统组件都适合自动化。

- SRE广泛使用的工具有： Puppet、Chef、cfengine

### Google SRE部门中的软件工程实践
- SRE组织的知道思想是，团队大小不应该与用户服务规模呈比例增长。
- Auxon：Google SRE内部开发的一个自动容量规划的工具
- 传统容量规划出现的问题：
1. 容量的预测：需要收集足够的数据以预测未来的需求。此过程非常麻烦并且容易出错
2. 手工进行资源编排非常复杂和繁琐
3. 一系列的容量需求与资源用量的组合是一个NP-hard的问题

- 解决方案：基于意图的容量规划，简单来说规划过程是将服务的依赖和资源的参数（意图）用编程的方式记录下来，同时利用一个算法自动产生资源的配给方案，包括在哪个集群中将多少资源配给哪个服务这些细节。
1. 如何理解意图？具体的容量需求到背后通常可以抽象以下几个级别：精确-一般-模糊，服务提供的意图越多得到的好处就越大。
2. 完整表达某个服务意图需要的信息：依赖关系、性能指标和优先级。\\
依赖关系：依赖的某些基础设施要处于30ms的网络延迟范围内，此项要求对基础设施位置的选择极为重要。更为重要的是依赖是嵌套的。\\
性能指标：例如需要多少计算资源以服务N个用户请求？需要多少Mb/s的数据以服务N个服务的用户请求？\\
优先级：每个资源都会面临无法逃避的问题，在资源不够的情况下，哪些资源可以被牺牲掉？

### 前端服务器的负载均衡与数据中心内部的负载均衡
- 全局层：用户的需求不同，是我们在全局层面决定“最优”分配方案的重要属性，例如：
1. 对于搜索请求：用户关注的是时延，因此搜索请求会被发往最近的、可用的数据中心。
2. 对于视频上传需求：用户关注的是吞吐量，发送到一条目前带宽没有占满的链路来最大化吞吐量，同时牺牲一些延迟
- 局部层：在一个数据中心内部，所有的服务器都在同一个网络中，对用户来说是等距的，因此在这个层面上的最优分配往往关注于资源的利用率，避免某个服务器的负载过高。
- 使用DNS进行负载均衡
- 使用虚拟IP进行负载均衡：VIP是由很多设备共享的，关键部分称之为网络负载均衡器
1. 一致性hash算法的应用，在新服务器被添加或删除的时候，最小程度地减少为现存连接的影响。
因此在实际应用中：在平时可以使用简单的连接追踪机制，在系统压力上升时切换为一致性hash
一致性hash主要是为了解决负载均衡。